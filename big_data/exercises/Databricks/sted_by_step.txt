import matplotlib.pyplot as plt
import pandas as pd

# Ejecutar la consulta SQL y almacenar los resultados en un DataFrame de Pandas
query_result = spark.sql("""
    SELECT
        t1.MainGenre,
        ROUND(AVG(t1.rating), 2) AS Promedio
    FROM
        default.netflix_refined t1
    WHERE
        t1.MainGenre IS NOT NULL
    GROUP BY
        t1.MainGenre
    ORDER BY
        Promedio DESC
""").toPandas()

# Crear un gráfico de barras
plt.figure(figsize=(10, 6))
plt.bar(query_result['MainGenre'], query_result['Promedio'], color='skyblue')
plt.title('Promedio del rating por género')
plt.xlabel('Género')
plt.ylabel('Promedio del rating')
plt.xticks(rotation=45, ha='right')
plt.tight_layout()
plt.show()
